<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Undo Functionality</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            margin: 10px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.success:hover {
            background: #218838;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Undo Functionality</h1>
    
    <div class="instructions">
        <h3>üìã Instructions:</h3>
        <ol>
            <li>Make sure the AI Misuse Detection extension is installed and enabled</li>
            <li>Type some malicious content in the test inputs below</li>
            <li>Wait for the content to be blocked and the notification to appear</li>
            <li>Click the "Restore Content" button in the notification</li>
            <li>Verify that the content is restored to the input field</li>
        </ol>
    </div>

    <div class="warning">
        <h3>‚ö†Ô∏è Important:</h3>
        <p>This test page contains intentionally malicious content for testing purposes only. The extension should block this content and allow you to restore it using the undo button.</p>
    </div>

    <div class="test-section">
        <h3>Test Input 1: Textarea</h3>
        <textarea class="test-input" placeholder="Type malicious content here to test blocking and undo functionality..."></textarea>
        <p><strong>Test content to try:</strong></p>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to kill a person')">Test: "how to kill a person"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to make a bomb')">Test: "how to make a bomb"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to hack into a computer')">Test: "how to hack into a computer"</button>
    </div>

    <div class="test-section">
        <h3>Test Input 2: Contenteditable Div</h3>
        <div class="test-input" contenteditable="true" placeholder="Type malicious content here to test blocking and undo functionality..."></div>
        <p><strong>Test content to try:</strong></p>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'create nude image')">Test: "create nude image"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to poison someone')">Test: "how to poison someone"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to steal credit card')">Test: "how to steal credit card"</button>
    </div>

    <div class="test-section">
        <h3>Test Input 3: Regular Input</h3>
        <input type="text" class="test-input" placeholder="Type malicious content here to test blocking and undo functionality...">
        <p><strong>Test content to try:</strong></p>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to commit suicide')">Test: "how to commit suicide"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to make drugs')">Test: "how to make drugs"</button>
        <button class="test-button danger" onclick="testMaliciousContent(this, 'how to scam people')">Test: "how to scam people"</button>
    </div>

    <div class="test-section">
        <h3>üß™ Debug Tools</h3>
        <button class="test-button" onclick="checkExtensionStatus()">Check Extension Status</button>
        <button class="test-button" onclick="checkDetectionFlags()">Check Detection Flags</button>
        <button class="test-button" onclick="checkLastClearedStatus()">Check Last Cleared Status</button>
        <button class="test-button" onclick="testUndoFunctionality()">Test Undo Functionality</button>
        <button class="test-button success" onclick="forceStoreTestContent()">Force Store Test Content</button>
        <button class="test-button" onclick="clearStoredContent()">Clear Stored Content</button>
        
        <div class="debug-info" id="debugOutput">
            Debug output will appear here...
        </div>
    </div>

    <div class="test-section">
        <h3>üìä Test Results</h3>
        <div id="testResults">
            <p>Test results will appear here...</p>
        </div>
    </div>

    <script>
        function log(message) {
            const debugOutput = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `[${timestamp}] ${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }

        function testMaliciousContent(button, content) {
            const buttonText = button.textContent;
            const testType = buttonText.split(': ')[1];
            
            log(`üß™ Testing malicious content: "${testType}"`);
            
            // Find the input field above this button
            const testSection = button.closest('.test-section');
            const input = testSection.querySelector('.test-input');
            
            if (input) {
                // Set the content
                if (input.tagName === 'TEXTAREA' || input.tagName === 'INPUT') {
                    input.value = content;
                } else if (input.contentEditable === 'true') {
                    input.textContent = content;
                }
                
                // Trigger input event to simulate user typing
                input.dispatchEvent(new Event('input', { bubbles: true }));
                
                log(`‚úÖ Set content in ${input.tagName}: "${content}"`);
                log(`üîç Waiting for extension to detect and block content...`);
                
                // Update test results
                updateTestResults(testType, 'Content set, waiting for detection...');
            }
        }

        function checkExtensionStatus() {
            log('üîç Checking extension status...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                log('‚úÖ Chrome extension API available');
                
                if (window.aiDetectorDebug) {
                    log('‚úÖ AI Detector debug functions available');
                    const protectionStatus = window.aiDetectorDebug.checkProtectionStatus();
                    log(`üõ°Ô∏è Protection status: ${protectionStatus ? 'ENABLED' : 'DISABLED'}`);
                } else {
                    log('‚ùå AI Detector debug functions not available');
                }
            } else {
                log('‚ùå Chrome extension API not available');
            }
        }

        function checkDetectionFlags() {
            log('üîç Checking detection flags...');
            
            if (window.aiDetectorDebug && window.aiDetectorDebug.showFlagStatus) {
                window.aiDetectorDebug.showFlagStatus();
                log('‚úÖ Detection flags checked (see console for details)');
            } else {
                log('‚ùå AI Detector debug functions not available');
            }
        }

        function checkLastClearedStatus() {
            log('üîç Checking last cleared status...');
            
            if (window.aiDetectorDebug && window.aiDetectorDebug.checkLastClearedStatus) {
                const status = window.aiDetectorDebug.checkLastClearedStatus();
                log('‚úÖ Last cleared status checked (see console for details)');
                log(`üìä Status: ${JSON.stringify(status)}`);
            } else {
                log('‚ùå AI Detector debug functions not available');
            }
        }

        function testUndoFunctionality() {
            log('üß™ Testing undo functionality...');
            
            if (window.aiDetectorDebug && window.aiDetectorDebug.testUndo) {
                window.aiDetectorDebug.testUndo();
                log('‚úÖ Undo test executed (see console for details)');
            } else {
                log('‚ùå AI Detector debug functions not available');
            }
        }

        function forceStoreTestContent() {
            log('üß™ Force storing test content...');
            
            if (window.aiDetectorDebug && window.aiDetectorDebug.forceStoreContent) {
                const success = window.aiDetectorDebug.forceStoreContent(
                    'This is test content for undo functionality', 
                    'textarea.test-input'
                );
                
                if (success) {
                    log('‚úÖ Test content stored successfully');
                    updateTestResults('Force Store', 'Test content stored successfully');
                } else {
                    log('‚ùå Failed to store test content');
                    updateTestResults('Force Store', 'Failed to store test content');
                }
            } else {
                log('‚ùå AI Detector debug functions not available');
            }
        }

        function clearStoredContent() {
            log('üß™ Clearing stored content...');
            
            if (window.aiDetectorDebug && window.aiDetectorDebug.clearStoredContent) {
                window.aiDetectorDebug.clearStoredContent();
                log('‚úÖ Stored content cleared');
                updateTestResults('Clear Content', 'Stored content cleared');
            } else {
                log('‚ùå AI Detector debug functions not available');
            }
        }

        function updateTestResults(testType, result) {
            const testResults = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const resultDiv = document.createElement('div');
            resultDiv.innerHTML = `<strong>[${timestamp}] ${testType}:</strong> ${result}`;
            testResults.appendChild(resultDiv);
        }

        // Auto-check extension status when page loads
        window.addEventListener('load', function() {
            log('üöÄ Page loaded, checking extension status...');
            setTimeout(checkExtensionStatus, 1000);
        });

        // Monitor for extension messages
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
                log(`üì® Extension message received: ${request.action}`);
                if (request.action === 'toggleProtection') {
                    log(`üõ°Ô∏è Protection toggled to: ${request.enabled ? 'ENABLED' : 'DISABLED'}`);
                }
            });
        }
    </script>
</body>
</html>
